import{a as e}from"./index.170962620808122.js";import{d as o}from"./download.1709626208081.js";import{_ as a,g as t,E as l}from"./index.1709626208081.js";import{d as r,h as d,a1 as u,aa as s,a as p,Y as n,S as i,e as c,ah as m,o as f,b as y,W as g,R as h,X as _,V as b,F as x,a7 as S}from"./vue.1709626208081.js";const v={productKey:"",path:""},k=r({setup(a,{emit:r}){const p=t("/base-api/api/v1/product/device/import"),n={Authorization:"Bearer "+localStorage.token},i=d(null),m=d(null),f=u({isShowDialog:!1,open_type:"",productData:[],ruleForm:{...v},rules:{productKey:[{required:!0,message:"所属产品不能为空",trigger:"blur"}]}}),y=()=>{f.ruleForm={...v}},g=()=>{f.isShowDialog=!1};return{uploadUrl:p,headers:n,tagRef:m,beforeAvatarUpload:e=>f.ruleForm.productKey?!(e.size/1024/1024>2)||(l.error("文件不能超过2MB!"),!1):(l.error("请先选择所属产品!"),!1),down:()=>{const e=document.createElement("a");e.href="/deviceImportExample.xlsx",e.setAttribute("download","deviceImportExample.xlsx"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},updateImg:e=>{0===e.code?(l.success("导入成功"),g(),r("typeList")):l.error(e.message)},openDialog:o=>{y(),e.product.getLists({status:1}).then((e=>{f.productData=e.product||[]})),f.open_type=o,f.isShowDialog=!0},closeDialog:g,onCancel:()=>{g()},onSubmit:()=>{const a=c(i);a&&a.validate((a=>{if(a)if("upload"===f.open_type)e.device["import"](f.ruleForm).then((e=>{l.success("导入成功"),g()}));else{const a=f.productData.find((e=>e.key===f.ruleForm.productKey));a&&(e.device["export"]({productKey:f.ruleForm.productKey}).then((e=>o(e,a.name+"-"+(()=>{const e=new Date;return e.getFullYear().toString()+(e.getMonth()+1).toString().padStart(2,"0")+e.getDate().toString().padStart(2,"0")+e.getHours().toString().padStart(2,"0")+e.getMinutes().toString().padStart(2,"0")})()+".xlsx"))),g())}}))},formRef:i,...s(f)}}}),w={"class":"system-edit-dic-container"},D={"class":"dialog-footer"};var F=a(k,[["render",function(e,o,a,t,l,r){const d=m("el-option"),u=m("el-select"),s=m("el-form-item"),c=m("ele-Upload"),v=m("el-icon"),k=m("el-button"),F=m("el-upload"),K=m("ele-Download"),C=m("el-form"),U=m("el-dialog");return f(),p("div",w,[n(U,{title:("upload"===e.open_type?"导入":"导出")+"设备",modelValue:e.isShowDialog,"onUpdate:modelValue":o[1]||(o[1]=o=>e.isShowDialog=o),width:"769px"},{footer:i((()=>[y("span",D,[n(k,{onClick:e.onCancel},{"default":i((()=>[g("取 消")])),_:1},8,["onClick"]),"upload"!==e.open_type?(f(),h(k,{key:0,type:"primary",onClick:e.onSubmit},{"default":i((()=>[g(_("upload"===e.open_type?"导入设备":"导出设备"),1)])),_:1},8,["onClick"])):b("",!0)])])),"default":i((()=>[n(C,{model:e.ruleForm,ref:"formRef",rules:e.rules,"label-width":"110px"},{"default":i((()=>[n(s,{label:"所属产品",prop:"productKey"},{"default":i((()=>[n(u,{modelValue:e.ruleForm.productKey,"onUpdate:modelValue":o[0]||(o[0]=o=>e.ruleForm.productKey=o),placeholder:"请选择所属产品","class":"w100"},{"default":i((()=>[(f(!0),p(x,null,S(e.productData,(e=>(f(),h(d,{key:e.key,label:e.name,value:e.key},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"upload"===e.open_type?(f(),h(s,{key:0,label:"导入文件",prop:"path"},{"default":i((()=>[n(F,{accept:"xls,xlsx,csv","show-file-list":!0,data:{productKey:e.ruleForm.productKey},limit:1,headers:e.headers,action:e.uploadUrl,"on-success":e.updateImg,"before-upload":e.beforeAvatarUpload},{"default":i((()=>[n(k,null,{"default":i((()=>[n(v,null,{"default":i((()=>[n(c)])),_:1}),g(" 上传文件 ")])),_:1})])),_:1},8,["data","headers","action","on-success","before-upload"]),y("div",null,_(e.ruleForm.path),1)])),_:1})):b("",!0),"upload"===e.open_type?(f(),h(s,{key:1,label:"样表下载"},{"default":i((()=>[n(k,{onClick:e.down,type:"primary",text:"primary"},{"default":i((()=>[n(v,null,{"default":i((()=>[n(K)])),_:1}),g(" 下载文件 ")])),_:1},8,["onClick"])])),_:1})):b("",!0)])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])}]]);export{F as default};