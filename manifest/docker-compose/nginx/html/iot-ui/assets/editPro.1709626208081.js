import{a as e}from"./index.170962620808122.js";import{c as a}from"./index.17096262080818.js";import{u as l}from"./index.170962620808113.js";import{v as o}from"./validator.1709626208081.js";import{_ as t,g as r,E as u}from"./index.1709626208081.js";import s from"./edit.17096262080815.js";import{d,h as m,a1 as n,aa as i,a as c,Y as p,S as g,j as y,e as h,ah as f,o as F,b as V,W as _,X as b,V as v,F as k,a7 as U,R as T}from"./vue.1709626208081.js";const C={id:0,name:"",key:"",categoryId:"",messageProtocol:"",transportProtocol:"",deviceType:"设备",status:1,desc:"",icon:"",authType:null,authUser:"",authPasswd:"",accessToken:"",certificateId:""},D=d({name:"deviceEditPro",components:{EditCategory:s,uploadVue:l},setup(l,{emit:t}){const s=m(null),d=r("/base-api/api/v1"),{proxy:c}=y(),{network_server_type:p}=c.useDict("network_server_type"),g=m([]),f=m(!1),F=m(),V=n({isShowDialog:!1,cateData:[],deptData:[],messageData:[],network_protocols:[],tranData:[],imageUrl:"",singleImg:d+"/product/icon/upload",ruleForm:{...C},rules:{name:[{required:!0,message:"产品名称不能为空",trigger:"change"},{max:32,message:"产品名称不能超过32个字符",trigger:"change"},{validator:o,message:"产品名称不能包含空格",trigger:"change"}],key:[{required:!0,message:"产品标识不能为空",trigger:"change"},{validator:o,message:"产品标识不能包含空格",trigger:"change"}],messageProtocol:[{required:!0,message:"消息协议不能为空",trigger:"change"}],transportProtocol:[{required:!0,message:"接入方式不能为空",trigger:"change"}],categoryId:[{required:!0,message:"产品分类不能为空",trigger:"change"}],deviceType:[{required:!0,message:"设备类型不能为空",trigger:"change"}]}}),_=()=>{V.ruleForm={...C};const e=h(s);e&&e.resetFields()},b=()=>{_(),V.isShowDialog=!1},v=e=>{V.ruleForm.authType="mqtt_server"===e?1:3};return{transportProtocolChange:v,submitLoading:f,certList:g,openDialog:l=>{_(),e.category.getList({status:1}).then((e=>{V.cateData=e.category||[]})),e.dept.getList({status:-1}).then((e=>{V.deptData=e||[]})),e.product.getTypesAll({types:"protocol"}).then((e=>{V.messageData=e||[]})),a.certificateManagement.getAll().then((e=>{g.value=e.Info||[]})),l?(V.imageUrl=l.icon,V.ruleForm=l,0===l.authType&&v(l.transportProtocol)):V.imageUrl="",V.isShowDialog=!0},onOpenAddCategory:()=>{F.value.openDialog()},handleAvatarSuccess:e=>{V.imageUrl=e,V.ruleForm.icon=e},closeDialog:b,onCancel:()=>{b()},onSubmit:()=>{const a=h(s);a&&a.validate((a=>{a&&(f.value=!0,0!==V.ruleForm.id?e.product.edit(V.ruleForm).then((()=>{u.success("产品修改成功"),b(),t("typeList")}))["finally"]((()=>f.value=!1)):e.product.add(V.ruleForm).then((()=>{u.success("产品添加成功"),b(),t("typeList")}))["finally"]((()=>f.value=!1)))}))},network_server_type:p,getCategoryList:()=>{e.category.getList({status:1}).then((e=>{V.cateData=e.category||[]}))},formRef:s,editCategoryRef:F,...i(V)}}}),P={"class":"system-edit-dic-container"},w={key:0},S={"class":"dialog-footer"};var I=t(D,[["render",function(e,a,l,o,t,r){const u=f("el-input"),s=f("el-form-item"),d=f("uploadVue"),m=f("el-cascader"),n=f("el-button"),i=f("el-option"),y=f("el-select"),h=f("el-radio"),C=f("el-radio-group"),D=f("el-form"),I=f("el-dialog"),L=f("EditCategory");return F(),c("div",P,[p(I,{title:(0!==e.ruleForm.id?"修改":"添加")+"产品",modelValue:e.isShowDialog,"onUpdate:modelValue":a[13]||(a[13]=a=>e.isShowDialog=a),width:"769px"},{footer:g((()=>[V("span",S,[p(n,{onClick:e.onCancel},{"default":g((()=>[_("取 消")])),_:1},8,["onClick"]),p(n,{type:"primary",onClick:e.onSubmit,loading:e.submitLoading},{"default":g((()=>[_(b(0!==e.ruleForm.id?"修 改":"添 加"),1)])),_:1},8,["onClick","loading"])])])),"default":g((()=>[p(D,{model:e.ruleForm,ref:"formRef",rules:e.rules,"label-width":"100px"},{"default":g((()=>[p(s,{label:"产品标识",prop:"key"},{"default":g((()=>[p(u,{modelValue:e.ruleForm.key,"onUpdate:modelValue":a[0]||(a[0]=a=>e.ruleForm.key=a),placeholder:"请输入产品标识",disabled:e.ruleForm.id},null,8,["modelValue","disabled"])])),_:1}),p(s,{label:"产品名称",prop:"name"},{"default":g((()=>[p(u,{modelValue:e.ruleForm.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.ruleForm.name=a),placeholder:"请输入产品名称"},null,8,["modelValue"])])),_:1}),p(s,{label:"产品图片",prop:"imageUrl"},{"default":g((()=>[p(d,{img:e.imageUrl,onSetImg:e.handleAvatarSuccess},null,8,["img","onSetImg"])])),_:1}),p(s,{label:"产品分类",prop:"categoryId"},{"default":g((()=>[p(m,{options:e.cateData,props:{checkStrictly:!0,emitPath:!1,value:"id",label:"name"},placeholder:"请选择分类","class":"w",clearable:"",modelValue:e.ruleForm.categoryId,"onUpdate:modelValue":a[2]||(a[2]=a=>e.ruleForm.categoryId=a)},{"default":g((({node:e,data:a})=>[V("span",null,b(a.name),1),e.isLeaf?v("",!0):(F(),c("span",w," ("+b(a.children.length)+") ",1))])),_:1},8,["options","modelValue"]),p(n,{type:"success",onClick:a[3]||(a[3]=a=>e.onOpenAddCategory()),style:{"margin-left":"5px"}},{"default":g((()=>[_("添加产品分类")])),_:1})])),_:1}),p(s,{label:"消息协议",prop:"messageProtocol"},{"default":g((()=>[p(y,{modelValue:e.ruleForm.messageProtocol,"onUpdate:modelValue":a[4]||(a[4]=a=>e.ruleForm.messageProtocol=a),placeholder:"请选择消息协议"},{"default":g((()=>[(F(!0),c(k,null,U(e.messageData,(e=>(F(),T(i,{key:e.types,label:e.title,value:e.name},null,8,["label","value"])))),128)),p(i,{label:"Sagoo Mqtt",value:"SagooMqtt"})])),_:1},8,["modelValue"])])),_:1}),p(s,{label:"接入方式",prop:"transportProtocol"},{"default":g((()=>[p(y,{modelValue:e.ruleForm.transportProtocol,"onUpdate:modelValue":a[5]||(a[5]=a=>e.ruleForm.transportProtocol=a),placeholder:"请选择接入方式",onChange:e.transportProtocolChange},{"default":g((()=>[(F(!0),c(k,null,U(e.network_server_type,(e=>(F(),T(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),1===e.ruleForm.authType||2===e.ruleForm.authType?(F(),c(k,{key:0},[p(s,{label:"认证方式",prop:""},{"default":g((()=>[p(C,{modelValue:e.ruleForm.authType,"onUpdate:modelValue":a[6]||(a[6]=a=>e.ruleForm.authType=a)},{"default":g((()=>[p(h,{label:1},{"default":g((()=>[_("Basic")])),_:1}),p(h,{label:2},{"default":g((()=>[_("AccessToken")])),_:1})])),_:1},8,["modelValue"])])),_:1}),1===e.ruleForm.authType?(F(),c(k,{key:0},[p(s,{label:"用户名",prop:"authUser"},{"default":g((()=>[p(u,{modelValue:e.ruleForm.authUser,"onUpdate:modelValue":a[7]||(a[7]=a=>e.ruleForm.authUser=a),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),p(s,{label:"密码",prop:"authPasswd"},{"default":g((()=>[p(u,{type:"password",modelValue:e.ruleForm.authPasswd,"onUpdate:modelValue":a[8]||(a[8]=a=>e.ruleForm.authPasswd=a),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})],64)):(F(),T(s,{key:1,label:"Aceess Token",prop:"accessToken"},{"default":g((()=>[p(u,{modelValue:e.ruleForm.accessToken,"onUpdate:modelValue":a[9]||(a[9]=a=>e.ruleForm.accessToken=a),placeholder:"请输入Aceess Token"},null,8,["modelValue"])])),_:1}))],64)):3===e.ruleForm.authType?(F(),T(s,{key:1,label:"认证证书",prop:"certificateId"},{"default":g((()=>[p(y,{modelValue:e.ruleForm.certificateId,"onUpdate:modelValue":a[10]||(a[10]=a=>e.ruleForm.certificateId=a),placeholder:"请选择证书"},{"default":g((()=>[(F(!0),c(k,null,U(e.certList,(e=>(F(),T(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):v("",!0),p(s,{label:"设备类型",prop:"deviceType"},{"default":g((()=>[p(C,{modelValue:e.ruleForm.deviceType,"onUpdate:modelValue":a[11]||(a[11]=a=>e.ruleForm.deviceType=a)},{"default":g((()=>[p(h,{label:"设备"},{"default":g((()=>[_("设备")])),_:1}),p(h,{label:"网关"},{"default":g((()=>[_("网关")])),_:1}),p(h,{label:"子设备"},{"default":g((()=>[_("子设备")])),_:1})])),_:1},8,["modelValue"])])),_:1}),p(s,{label:"产品描述\t",prop:"desc"},{"default":g((()=>[p(u,{modelValue:e.ruleForm.desc,"onUpdate:modelValue":a[12]||(a[12]=a=>e.ruleForm.desc=a),type:"textarea",placeholder:"请输入产品描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),p(L,{ref:"editCategoryRef",onGetCateList:e.getCategoryList},null,8,["onGetCateList"])])}],["__scopeId","data-v-169ed90c"]]);export{I as default};