import{d as defineComponent,a1 as reactive,h as ref,k as onMounted,aa as toRefs,a as createElementBlock,Y as createVNode,S as withCtx,b as createBaseVNode,j as getCurrentInstance,aC as useRoute,aE as useRouter,ah as resolveComponent,o as openBlock,F as Fragment,a7 as renderList,R as createBlock,T as withDirectives,Z as vShow,W as createTextVNode,V as createCommentVNode}from"./vue.1709626208081.js";import{_ as _sfc_main$1}from"./index.170962620808127.js";import{a as api$1}from"./index.170962620808130.js";import{a as api}from"./index.170962620808122.js";import{_ as _export_sfc,E as ElMessage}from"./index.1709626208081.js";var create_vue_vue_type_style_index_0_lang="",create_vue_vue_type_style_index_1_scoped_true_lang="";const _sfc_main=defineComponent({name:"tunnelCreate",components:{codeEditor:_sfc_main$1},props:{type:{type:String,"default":""}},setup(props){const{proxy:proxy}=getCurrentInstance(),route=useRoute(),router=useRouter(),{network_tunnel_type:network_tunnel_type,tunnel_serial_baudrate:tunnel_serial_baudrate,tunnel_serial_databits:tunnel_serial_databits,tunnel_serial_stopbits:tunnel_serial_stopbits,tunnel_serial_parity:tunnel_serial_parity,network_protocols:network_protocols}=proxy.useDict("network_tunnel_type","tunnel_serial_baudrate","tunnel_serial_databits","tunnel_serial_stopbits","tunnel_serial_parity","network_protocols"),state=reactive({resourceModalPro:{mode:"",content:""},detail:{},messageData:[],activeViewName:["1","2","3","4","5"],form:{name:"",types:"serial",status:!1,addr:"",serial:{baud_rate:"9600",data_bits:"6",stop_bits:"1",parity:"0"},retry:{enable:!0,timeout:30,maximum:0},protoccol:{name:"SagooMqtt",options:{}},heartbeat:{enable:!1,hex:"",regex:"^\\w+$",text:"",timeout:30}},rules:{name:[{required:!0,message:"名称不能为空",trigger:"change"}]}});api.product.getTypesAll({types:"protocol"}).then((e=>{state.messageData=e||[]}));const mirrorRef=ref("mirrorRef"),activeName=ref("first"),getDetail=()=>{const e=route.params&&route.params.id;api$1.tunnel.getDetail({id:e}).then((e=>{state.detail=e}))},submit=()=>{if(0==state.form.serial.parity&&(state.form.serial.rs485=!1,delete state.form.serial.port),1!=state.form.serial.parity&&2!=state.form.serial.parity||(state.form.serial.port=null,delete state.form.serial.rs485),mirrorRef.value.getValue())try{state.form.protoccol.options=eval("("+mirrorRef.value.getValue()+")")}catch(error){return ElMessage("协议参数解析错误")}api$1.tunnel.addItem({...state.form}).then((e=>{ElMessage.success("添加成功"),goBack()}))},goBack=()=>{router.go(-1)};return onMounted((()=>{var e=JSON.stringify({});state.resourceModalPro.content=JSON.stringify(JSON.parse(e),null,4)})),{mirrorRef:mirrorRef,activeName:activeName,getDetail:getDetail,network_tunnel_type:network_tunnel_type,tunnel_serial_baudrate:tunnel_serial_baudrate,tunnel_serial_databits:tunnel_serial_databits,tunnel_serial_stopbits:tunnel_serial_stopbits,tunnel_serial_parity:tunnel_serial_parity,network_protocols:network_protocols,submit:submit,goBack:goBack,...toRefs(props),...toRefs(state)}}}),_hoisted_1={"class":"page bg padding page-full Ipt-2",style:{position:"relative"}},_hoisted_2={"class":"collapse-wrap"},_hoisted_3={"class":"collapse-wrap"},_hoisted_4={style:{position:"absolute",right:"20px",top:"14px"}};function _sfc_render(e,t,a,l,o,r){const n=resolveComponent("el-input"),s=resolveComponent("el-form-item"),d=resolveComponent("el-option"),i=resolveComponent("el-select"),u=resolveComponent("el-switch"),m=resolveComponent("el-form"),c=resolveComponent("el-collapse-item"),p=resolveComponent("el-button"),_=resolveComponent("el-input-number"),f=resolveComponent("codeEditor"),V=resolveComponent("el-collapse"),h=resolveComponent("el-tab-pane"),b=resolveComponent("el-tabs");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(b,{modelValue:e.activeName,"onUpdate:modelValue":t[14]||(t[14]=t=>e.activeName=t)},{"default":withCtx((()=>[createVNode(h,{label:"新增通道",name:"first"},{"default":withCtx((()=>[createVNode(V,{modelValue:e.activeViewName,"onUpdate:modelValue":t[13]||(t[13]=t=>e.activeViewName=t)},{"default":withCtx((()=>[createVNode(c,{title:"基本信息",name:"1"},{"default":withCtx((()=>[createBaseVNode("div",_hoisted_2,[createVNode(m,{style:{width:"600px",margin:"0 auto"},model:e.form,rules:e.rules,"label-width":"68px"},{"default":withCtx((()=>[createVNode(s,{label:"名称",prop:"name"},{"default":withCtx((()=>[createVNode(n,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.name=t),"show-word-limit":"",maxlength:"20",placeholder:"请填写名称"},null,8,["modelValue"])])),_:1}),createVNode(s,{label:"类型"},{"default":withCtx((()=>[createVNode(i,{modelValue:e.form.types,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.types=t),placeholder:"请选择类型"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.network_tunnel_type,(e=>(openBlock(),createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),withDirectives(createVNode(s,{label:"地址"},{"default":withCtx((()=>[createVNode(n,{modelValue:e.form.addr,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.addr=t),placeholder:"端口号，IP:端口"},null,8,["modelValue"])])),_:1},512),[[vShow,"serial"!=e.form.types]]),createVNode(s,{label:"启用"},{"default":withCtx((()=>[createVNode(u,{modelValue:e.form.status,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1}),withDirectives(createVNode(c,{title:"串口参数",name:"2"},{"default":withCtx((()=>[createBaseVNode("div",_hoisted_3,[createVNode(m,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"68px"},{"default":withCtx((()=>[createVNode(s,{label:"端口"},{"default":withCtx((()=>[createVNode(p,null,{"default":withCtx((()=>[createTextVNode("/dev/ttyS0")])),_:1})])),_:1}),createVNode(s,{label:"波特率"},{"default":withCtx((()=>[createVNode(i,{modelValue:e.form.serial.baud_rate,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.serial.baud_rate=t),placeholder:"请选择波特率"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tunnel_serial_baudrate,(e=>(openBlock(),createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),createVNode(s,{label:"数据位"},{"default":withCtx((()=>[createVNode(i,{modelValue:e.form.serial.data_bits,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.serial.data_bits=t),placeholder:"请选择数据位"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tunnel_serial_databits,(e=>(openBlock(),createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),createVNode(s,{label:"停止位"},{"default":withCtx((()=>[createVNode(i,{modelValue:e.form.serial.stop_bits,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.serial.stop_bits=t),placeholder:"请选择停止位"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tunnel_serial_stopbits,(e=>(openBlock(),createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),createVNode(s,{label:"检验位"},{"default":withCtx((()=>[createVNode(i,{modelValue:e.form.serial.parity,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.serial.parity=t),placeholder:"请选择检验位"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tunnel_serial_parity,(e=>(openBlock(),createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},512),[[vShow,"serial"==e.form.types]]),withDirectives(createVNode(c,{title:"心跳包",name:"3"},{"default":withCtx((()=>[createVNode(m,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"68px"},{"default":withCtx((()=>[createVNode(s,{label:"启用"},{"default":withCtx((()=>[createVNode(u,{modelValue:e.form.heartbeat.enable,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.heartbeat.enable=t)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},512),[[vShow,"serial"!=e.form.type]]),"serial"==e.form.types||"tcp-client"==e.form.types||"udp-client"==e.form.types?(openBlock(),createBlock(c,{key:0,title:"断线重连",name:"4"},{"default":withCtx((()=>[createVNode(m,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"68px"},{"default":withCtx((()=>[createVNode(s,{label:"启用"},{"default":withCtx((()=>[createVNode(u,{modelValue:e.form.retry.enable,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.retry.enable=t)},null,8,["modelValue"])])),_:1}),createVNode(s,{label:"间隔"},{"default":withCtx((()=>[createVNode(_,{modelValue:e.form.retry.timeout,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.retry.timeout=t),min:0,onChange:e.handleChange},null,8,["modelValue","onChange"])])),_:1}),createVNode(s,{label:"最大次数"},{"default":withCtx((()=>[createVNode(_,{modelValue:e.form.retry.maximum,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.retry.maximum=t),min:0,onChange:e.handleChange},null,8,["modelValue","onChange"])])),_:1})])),_:1},8,["model"])])),_:1})):createCommentVNode("",!0),createVNode(c,{title:"协议适配",name:"5"},{"default":withCtx((()=>[createVNode(m,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"68px"},{"default":withCtx((()=>[createVNode(s,{label:"协议"},{"default":withCtx((()=>[createVNode(i,{modelValue:e.form.protoccol.name,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.protoccol.name=t),placeholder:"请选择协议适配"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.messageData,(e=>(openBlock(),createBlock(d,{key:e.types,label:e.title,value:e.name},null,8,["label","value"])))),128)),createVNode(d,{label:"Sagoo Mqtt",value:"SagooMqtt"})])),_:1},8,["modelValue"])])),_:1}),createVNode(s,{label:"协议参数"},{"default":withCtx((()=>[createVNode(f,{"class":"params",ref:"mirrorRef",mode:e.resourceModalPro.mode,content:e.resourceModalPro.content,getValue:e.getValue},null,8,["mode","content","getValue"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),createBaseVNode("div",_hoisted_4,[createVNode(p,{size:"small",onClick:t[15]||(t[15]=t=>e.$router.replace("/iotmanager/network/tunnel"))},{"default":withCtx((()=>[createTextVNode("取消")])),_:1}),createVNode(p,{onClick:e.submit,size:"small",type:"primary"},{"default":withCtx((()=>[createTextVNode("提交")])),_:1},8,["onClick"])])])}var create=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-fe8b5506"]]);export{create as default};