import{d as e,h as t,a1 as a,k as l,aa as i,a as o,b as d,X as n,T as s,Y as r,S as p,aC as c,ah as u,ar as m,o as f,R as v,W as b,V as g,Z as y,aA as w,aB as _}from"./vue.1709626208081.js";import{_ as h,g as k,J as D,E,h as T}from"./index.1709626208081.js";import{d as C}from"./download.1709626208081.js";import x from"./editPro.1709626208081.js";import z from"./deviceIn.1709626208081.js";import S from"./dataParse.1709626208081.js";import j from"./editAttr.1709626208081.js";import R from"./editFun.1709626208081.js";import L from"./editEvent.1709626208081.js";import O from"./editTab.1709626208081.js";import{a as A}from"./index.170962620808122.js";import"./index.17096262080818.js";import"./index.170962620808113.js";import"./validator.1709626208081.js";import"./edit.17096262080815.js";import"./index.170962620808127.js";import"./editOption.1709626208081.js";import"./typeItem.1709626208081.js";const F=e({name:"deviceEditPro",components:{EditDic:x,EditAttr:j,EditFun:R,EditEvent:L,EditTab:O,deviceIn:z,dataParse:S},setup(e,o){var d;const n=k("/base-api/api/v1/product/tsl/import"),s={Authorization:"Bearer "+localStorage.token},r=c(),p=t(),u=t(),m=t(),f=t(),v=t(),b=a({isShowDialog:!1,activeName:"1",activetab:"attr",detail:{},developer_status:0,tableData:{data:[],total:0,loading:!1,param:{pageNum:1,productKey:null==(d=r.params)?void 0:d.id,pageSize:10,status:"",dateRange:[]}}});function g(){var e;const t=null==(e=r.params)?void 0:e.id;A.product.detail(t).then((e=>{b.detail=e.data,b.developer_status=e.data.status}))}l((()=>{g(),A.model.property(b.tableData.param).then((e=>{b.tableData.data=e.Data,b.tableData.total=e.Total}))}));const y=()=>{switch(b.activetab){case"attr":w();break;case"fun":_();break;case"event":h();break;case"tab":x()}},w=()=>{A.model.property(b.tableData.param).then((e=>{b.tableData.data=e.Data,b.tableData.total=e.Total}))},_=()=>{A.model["function"](b.tableData.param).then((e=>{b.tableData.data=e.Data,b.tableData.total=e.Total}))},h=()=>{A.model.event(b.tableData.param).then((e=>{b.tableData.data=e.Data,b.tableData.total=e.Total}))},x=()=>{A.model.tag(b.tableData.param).then((e=>{b.tableData.data=e.Data,b.tableData.total=e.Total}))},z=()=>{const e=new Date;return e.getFullYear().toString()+(e.getMonth()+1).toString().padStart(2,"0")+e.getDate().toString().padStart(2,"0")+e.getHours().toString().padStart(2,"0")+e.getMinutes().toString().padStart(2,"0")};return{updateImg:e=>{0===e.code?(y(),E.success("物模型导入成功")):E.error(e.message)},headers:s,uploadUrl:n,getCurrentTime:z,onRowExport:()=>{A.product["export"]({productKey:b.detail.key}).then((e=>C(e,"TSL-"+b.detail.key+"-"+z()+".json")))},Edit:D,updateScript:e=>{b.detail.scriptInfo=e},editDicRef:p,editAttrRef:u,editFunRef:m,editEventRef:f,editTabRef:v,CkOption:e=>{0==e?A.product.undeploy(r.params.id).then((e=>{E.success("操作成功"),b.developer_status=0}))["catch"]((()=>b.developer_status=1)):A.product.deploy(r.params.id).then((e=>{E.success("操作成功"),b.developer_status=1}))["catch"]((()=>b.developer_status=0))},onRowDel:(e,t)=>{0!==e.length?T.confirm("此操作将永久删除该数据，是否继续?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{var a;const l=null==(a=r.params)?void 0:a.id;"attr"==t&&A.model.propertydel(l,e).then((()=>{E.success("删除成功"),w()})),"fun"==t&&A.model.functiondel(l,e).then((()=>{E.success("删除成功"),_()})),"event"==t&&A.model.eventdel(l,e).then((()=>{E.success("删除成功"),h()})),"tab"==t&&A.model.tagdel(l,e).then((()=>{E.success("删除成功"),x()}))}))["catch"]((()=>{})):E.error("请选择要删除的数据。")},onEditFun:e=>{m.value.openDialog(e,r.params.id)},onEditEvent:e=>{f.value.openDialog(e,r.params.id)},onEditTag:e=>{v.value.openDialog(e,r.params.id)},onEditAttr:e=>{u.value.openDialog(e,r.params.id)},getList:y,getproperty:w,getfunction:_,getevent:h,gettab:x,wuhandleClick:e=>{switch(b.activetab=e.props.name,e.props.name){case"attr":w();break;case"fun":_();break;case"event":h();break;case"tab":x()}},onOpenEditTab:()=>{v.value.openDialog({productKey:r.params.id,id:0,accessMode:1})},onOpenEditEvent:()=>{f.value.openDialog({productKey:r.params.id,id:0,level:0})},productDetail:g,onOpenEditAttr:()=>{u.value.openDialog({productKey:r.params.id,id:0,accessMode:1})},onOpenEditFun:()=>{m.value.openDialog({productKey:r.params.id,id:0})},onOpenEditDic:e=>{p.value.openDialog(e)},handleClick:(e,t)=>{},...i(b)}}}),U=e=>(w("data-v-6a4f388c"),e=e(),_(),e),V={"class":"page bg page-full"},I={"class":"content"},P={"class":"cont_box",style:{"align-items":"center"}},M={"class":"title"},N={"class":"pro-box"},K=U((()=>d("div",{"class":"protitle"},"产品信息",-1))),B={"class":"image-slot"},Y={"class":"wu-title"},H=U((()=>d("div",{"class":"title"},"属性定义",-1))),J={"class":"wu-title"},W=U((()=>d("div",{"class":"title"},"功能定义",-1))),X={"class":"wu-title"},Z=U((()=>d("div",{"class":"title"},"事件定义",-1))),q={"class":"wu-title"},G=U((()=>d("div",{"class":"title"},"标签定义",-1))),Q={"class":"import"},$={"class":"row_bet"};var ee=h(F,[["render",function(e,t,a,l,i,c){const w=u("el-switch"),_=u("el-button"),h=u("copy"),k=u("el-descriptions-item"),D=u("ele-Picture"),E=u("el-image"),T=u("el-descriptions"),C=u("el-tab-pane"),x=u("el-table-column"),z=u("el-tag"),S=u("el-table"),j=u("el-tabs"),R=u("ele-Upload"),L=u("el-icon"),O=u("el-upload"),A=u("ele-Download"),F=u("pagination"),U=u("deviceIn"),ee=u("dataParse"),te=u("EditDic"),ae=u("EditAttr"),le=u("EditFun"),ie=u("EditEvent"),oe=u("EditTab"),de=m("auth");return f(),o("div",V,[d("div",I,[d("div",P,[d("div",M,"产品："+n(e.detail.name),1),s(r(w,{style:{margin:"0 20px"},modelValue:e.developer_status,"onUpdate:modelValue":t[0]||(t[0]=t=>e.developer_status=t),"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"停用",onChange:e.CkOption},null,8,["modelValue","onChange"]),[[de,"startOrStop"]])])]),r(j,{modelValue:e.activeName,"onUpdate:modelValue":t[11]||(t[11]=t=>e.activeName=t),style:{padding:"0 20px"},onTabClick:e.handleClick},{"default":p((()=>[r(C,{label:"产品信息",name:"1"},{"default":p((()=>[d("div",N,[K,s((f(),v(_,{type:"",icon:e.Edit,"class":"buttonedit",onClick:t[1]||(t[1]=t=>e.onOpenEditDic(e.detail))},{"default":p((()=>[b("编辑")])),_:1},8,["icon"])),[[de,"edit"]])]),r(T,{"class":"margin-top",column:3,border:""},{"default":p((()=>[r(k,{label:"产品标识"},{"default":p((()=>[r(h,{text:e.detail.key},null,8,["text"])])),_:1}),r(k,{label:"产品分类"},{"default":p((()=>[b(n(e.detail.categoryName),1)])),_:1}),r(k,{label:"设备类型"},{"default":p((()=>[b(n(e.detail.deviceType),1)])),_:1}),r(k,{label:"产品图片"},{"default":p((()=>[r(E,{style:{width:"80px",height:"80px"},src:e.detail.icon,previewSrcList:[e.detail.icon],fit:"contain"},{error:p((()=>[d("div",B,[r(D,{style:{width:"30px"}}),b(" 加载失败 ")])])),_:1},8,["src","previewSrcList"])])),_:1}),r(k,{label:"消息协议"},{"default":p((()=>[b(n(e.detail.messageProtocol),1)])),_:1}),r(k,{label:"接入方式"},{"default":p((()=>[b(n(e.detail.transportProtocol),1)])),_:1}),r(k,{label:"描述"},{"default":p((()=>[b(n(e.detail.desc),1)])),_:1})])),_:1})])),_:1}),r(C,{label:"物模型",name:"2"},{"default":p((()=>[r(j,{type:"border-card",modelValue:e.activetab,"onUpdate:modelValue":t[6]||(t[6]=t=>e.activetab=t),onTabClick:e.wuhandleClick},{"default":p((()=>[r(C,{label:"属性定义",name:"attr"},{"default":p((()=>[d("div",Y,[H,d("div",null,[s((f(),v(_,{size:"small",type:"primary",onClick:t[2]||(t[2]=t=>e.onOpenEditAttr())},{"default":p((()=>[b("添加")])),_:1})),[[de,"edit"]])])]),"attr"==e.activetab?(f(),v(S,{key:0,style:{width:"100%"},data:e.tableData.data},{"default":p((()=>[r(x,{label:"属性标识",align:"center",prop:"key"}),r(x,{label:"属性名称",prop:"name","show-overflow-tooltip":""}),r(x,{prop:"valueType",label:"数据类型",width:"100",align:"center"},{"default":p((e=>[d("span",null,n(e.row.valueType.type),1)])),_:1}),r(x,{prop:"decimals",label:"精度",width:"60",align:"center"},{"default":p((e=>[d("span",null,n(e.row.valueType.decimals),1)])),_:1}),r(x,{prop:"unit",label:"单位",width:"60",align:"center"},{"default":p((e=>[d("span",null,n(e.row.valueType.unit),1)])),_:1}),r(x,{prop:"accessMode",label:"是否只读",width:"120",align:"center"},{"default":p((e=>[e.row.accessMode?(f(),v(z,{key:0,type:"info",size:"small"},{"default":p((()=>[b("只读")])),_:1})):(f(),v(z,{key:1,type:"success",size:"small"},{"default":p((()=>[b("读写")])),_:1}))])),_:1}),r(x,{label:"说明",prop:"desc","show-overflow-tooltip":""}),r(x,{label:"操作",width:"300",align:"center",fixed:"right"},{"default":p((t=>[s((f(),v(_,{size:"small",text:"",type:"warning",onClick:a=>e.onEditAttr(t.row)},{"default":p((()=>[b("修改")])),_:2},1032,["onClick"])),[[de,"edit"]]),s((f(),v(_,{size:"small",text:"",type:"danger",onClick:a=>e.onRowDel(t.row.key,"attr")},{"default":p((()=>[b("删除")])),_:2},1032,["onClick"])),[[de,"del"]])])),_:1})])),_:1},8,["data"])):g("",!0)])),_:1}),r(C,{label:"功能定义",name:"fun"},{"default":p((()=>[d("div",J,[W,d("div",null,[s((f(),v(_,{size:"small",type:"primary",onClick:t[3]||(t[3]=t=>e.onOpenEditFun())},{"default":p((()=>[b("添加")])),_:1})),[[de,"add"]])])]),"fun"==e.activetab?(f(),v(S,{key:0,style:{width:"100%"},data:e.tableData.data},{"default":p((()=>[r(x,{label:"功能标识",align:"center",prop:"key"}),r(x,{label:"名称",prop:"name","show-overflow-tooltip":""}),r(x,{label:"描述",prop:"desc","show-overflow-tooltip":""}),r(x,{label:"操作",width:"300",align:"center",fixed:"right"},{"default":p((t=>[s((f(),v(_,{size:"small",text:"",type:"warning",onClick:a=>e.onEditFun(t.row)},{"default":p((()=>[b("修改")])),_:2},1032,["onClick"])),[[de,"edit"]]),s((f(),v(_,{size:"small",text:"",type:"danger",onClick:a=>e.onRowDel(t.row.key,"fun")},{"default":p((()=>[b("删除")])),_:2},1032,["onClick"])),[[de,"del"]])])),_:1})])),_:1},8,["data"])):g("",!0)])),_:1}),r(C,{label:"事件定义",name:"event"},{"default":p((()=>[d("div",X,[Z,d("div",null,[s((f(),v(_,{size:"small",type:"primary",onClick:t[4]||(t[4]=t=>e.onOpenEditEvent())},{"default":p((()=>[b("添加")])),_:1})),[[de,"add"]])])]),"event"==e.activetab?(f(),v(S,{key:0,style:{width:"100%"},data:e.tableData.data},{"default":p((()=>[r(x,{label:"事件标识",align:"center",prop:"key"}),r(x,{label:"名称",prop:"name","show-overflow-tooltip":""}),r(x,{prop:"level",label:"事件级别",width:"120",align:"center"},{"default":p((e=>[0==e.row.level?(f(),v(z,{key:0,type:"primary",size:"small"},{"default":p((()=>[b("普通")])),_:1})):g("",!0),1==e.row.level?(f(),v(z,{key:1,type:"warning",size:"small"},{"default":p((()=>[b("警告")])),_:1})):g("",!0),2==e.row.level?(f(),v(z,{key:2,type:"danger",size:"small"},{"default":p((()=>[b("紧急")])),_:1})):g("",!0)])),_:1}),r(x,{label:"描述",prop:"desc","show-overflow-tooltip":""}),r(x,{label:"操作",width:"300",align:"center",fixed:"right"},{"default":p((t=>[s((f(),v(_,{size:"small",text:"",type:"warning",onClick:a=>e.onEditEvent(t.row)},{"default":p((()=>[b("修改")])),_:2},1032,["onClick"])),[[de,"edit"]]),s((f(),v(_,{size:"small",text:"",type:"danger",onClick:a=>e.onRowDel(t.row.key,"event")},{"default":p((()=>[b("删除")])),_:2},1032,["onClick"])),[[de,"del"]])])),_:1})])),_:1},8,["data"])):g("",!0)])),_:1}),r(C,{label:"标签定义",name:"tab"},{"default":p((()=>[d("div",q,[G,d("div",null,[s((f(),v(_,{size:"small",type:"primary",onClick:t[5]||(t[5]=t=>e.onOpenEditTab())},{"default":p((()=>[b("添加")])),_:1})),[[de,"add"]])])]),"tab"==e.activetab?(f(),v(S,{key:0,style:{width:"100%"},data:e.tableData.data},{"default":p((()=>[r(x,{label:"属性标识",align:"center",prop:"key"}),r(x,{label:"属性名称",prop:"name","show-overflow-tooltip":""}),r(x,{prop:"valueType",label:"数据类型",width:"120",align:"center"},{"default":p((e=>[d("span",null,n(e.row.valueType.type),1)])),_:1}),r(x,{prop:"accessMode",label:"是否只读",width:"120",align:"center"},{"default":p((e=>[e.row.accessMode?(f(),v(z,{key:0,type:"info",size:"small"},{"default":p((()=>[b("只读")])),_:1})):(f(),v(z,{key:1,type:"success",size:"small"},{"default":p((()=>[b("读写")])),_:1}))])),_:1}),r(x,{label:"描述",prop:"desc","show-overflow-tooltip":""}),r(x,{label:"操作",width:"300",align:"center",fixed:"right"},{"default":p((t=>[s((f(),v(_,{size:"small",text:"",type:"warning",onClick:a=>e.onEditTag(t.row)},{"default":p((()=>[b("修改")])),_:2},1032,["onClick"])),[[de,"edit"]]),s((f(),v(_,{size:"small",text:"",type:"danger",onClick:a=>e.onRowDel(t.row.key,"tab")},{"default":p((()=>[b("删除")])),_:2},1032,["onClick"])),[[de,"del"]])])),_:1})])),_:1},8,["data"])):g("",!0)])),_:1})])),_:1},8,["modelValue","onTabClick"]),d("div",Q,[d("div",$,[r(O,{accept:"json","show-file-list":!1,limit:1,data:{productKey:e.detail.key},headers:e.headers,action:e.uploadUrl,"on-success":e.updateImg},{"default":p((()=>[r(_,{size:"small"},{"default":p((()=>[r(L,null,{"default":p((()=>[r(R)])),_:1}),b(" 导入物模型 ")])),_:1})])),_:1},8,["data","headers","action","on-success"]),r(_,{size:"small",type:"default","class":"ml10",onClick:t[7]||(t[7]=t=>e.onRowExport())},{"default":p((()=>[r(L,null,{"default":p((()=>[r(A)])),_:1}),b(" 导出物模型 ")])),_:1})])]),s(r(F,{total:e.tableData.total,page:e.tableData.param.pageNum,"onUpdate:page":t[8]||(t[8]=t=>e.tableData.param.pageNum=t),limit:e.tableData.param.pageSize,"onUpdate:limit":t[9]||(t[9]=t=>e.tableData.param.pageSize=t),onPagination:t[10]||(t[10]=t=>e.getList())},null,8,["total","page","limit"]),[[y,e.tableData.total>0]])])),_:1}),r(C,{label:"设备接入",name:"3"},{"default":p((()=>[r(U)])),_:1}),r(C,{label:"数据解析",name:"4",lazy:""},{"default":p((()=>["4"===e.activeName?(f(),v(ee,{key:0,script:e.detail.scriptInfo,onUpdateScript:e.updateScript},null,8,["script","onUpdateScript"])):g("",!0)])),_:1})])),_:1},8,["modelValue","onTabClick"]),r(te,{ref:"editDicRef",onTypeList:e.productDetail},null,8,["onTypeList"]),r(ae,{ref:"editAttrRef",onTypeList:e.getproperty},null,8,["onTypeList"]),r(le,{ref:"editFunRef",onTypeList:e.getfunction},null,8,["onTypeList"]),r(ie,{ref:"editEventRef",onTypeList:e.getevent},null,8,["onTypeList"]),r(oe,{ref:"editTabRef",onTypeList:e.gettab},null,8,["onTypeList"])])}],["__scopeId","data-v-6a4f388c"]]);export{ee as default};