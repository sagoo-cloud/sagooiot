import{_ as _export_sfc,b as api$1,J as edit_default,E as ElMessage}from"./index.1709626208081.js";import{_ as _sfc_main$1}from"./index.170962620808127.js";import{d as defineComponent,a1 as reactive,h as ref,k as onMounted,i as watch,aa as toRefs,a as createElementBlock,Y as createVNode,S as withCtx,b as createBaseVNode,j as getCurrentInstance,aC as useRoute,ah as resolveComponent,o as openBlock,F as Fragment,a7 as renderList,R as createBlock,V as createCommentVNode,W as createTextVNode}from"./vue.1709626208081.js";import{a as api$2}from"./index.170962620808130.js";import{a as api}from"./index.170962620808122.js";var create_vue_vue_type_style_index_0_lang="",create_vue_vue_type_style_index_1_scoped_true_lang="";const _sfc_main=defineComponent({name:"serverCreate",components:{codeEditor:_sfc_main$1},props:{type:{type:String,"default":""}},setup(props){const{proxy:proxy}=getCurrentInstance(),route=useRoute(),{network_server_type:network_server_type,network_protocols:network_protocols}=proxy.useDict("network_server_type","network_protocols"),state=reactive({stickValue:"",stick:{"delimit,omitempty":"","custom,omitempty":"","fixedLen,omitempty":0,"len,omitempty":{len:0,offset:0,endian:""}},stick_type:[{label:"分隔符",value:"分隔符"},{label:"自定义脚本",value:"自定义脚本"},{label:"固定长度",value:"固定长度"},{label:"长度字段",value:"长度字段"}],resourceModalPro:{mode:"",content:""},detail:{},activeViewName:["1","2","3"],certificateList:[],messageData:[],form:{id:"",accessToken:"",authPasswd:"",authUser:"",authType:3,isTls:0,certificateId:"",name:"",types:"tcp",status:0,addr:"",register:{regex:"^w+$"},protocol:{name:"SagooMqtt",options:{}},heartbeat:{enable:!1,hex:"",regex:"^\\w+$",text:"",timeout:30},devices:[]}});api.product.getTypesAll({types:"protocol"}).then((e=>{state.messageData=e||[]}));const mirrorRef=ref("mirrorRef"),activeName=ref("first"),getDetail=()=>{const e=route.params&&route.params.id;api$2.tunnel.getDetail({id:e}).then((e=>{state.detail=e}))},submit=()=>{state.form.id||delete state.form.id;let params={...state.form,stick:{...state.stick}};mirrorRef.value.getValue()&&(state.form.protocol.options=eval("("+mirrorRef.value.getValue()+")")),api$2.server.addItem(params).then((e=>{ElMessage.success("添加成功"),goBack()}))};onMounted((()=>{var e=JSON.stringify({});state.resourceModalPro.content=JSON.stringify(JSON.parse(e),null,4),getCertificateList()}));const handleClick=(e,t)=>{},getCertificateList=()=>{api$1.certificate.getList().then((e=>{state.certificateList=e.Info}))},initData=()=>{state.stick={"delimit,omitempty":"","custom,omitempty":"","fixedLen,omitempty":0,"len,omitempty":{len:0,offset:0,endian:""}}},handleChangeType=()=>{"mqtt_server"==state.form.types||1!=state.form.isTls?0==state.form.isTls&&(state.form.authType=""):state.form.authType=3};return watch((()=>state.form.types),(e=>{getCertificateList()})),watch((()=>state.form.isTls),(e=>{0==e&&(state.form.authType="")})),{Edit:edit_default,mirrorRef:mirrorRef,activeName:activeName,getDetail:getDetail,handleClick:handleClick,network_server_type:network_server_type,network_protocols:network_protocols,getCertificateList:getCertificateList,submit:submit,initData:initData,handleChangeType:handleChangeType,...toRefs(props),...toRefs(state)}}}),_hoisted_1={"class":"page bg padding page-full Ipt-2",style:{position:"relative"}},_hoisted_2={"class":"collapse-wrap"},_hoisted_3={style:{position:"absolute",right:"20px",top:"14px"}};function _sfc_render(e,t,a,l,o,r){const c=resolveComponent("el-input"),d=resolveComponent("el-form-item"),m=resolveComponent("el-option"),s=resolveComponent("el-select"),n=resolveComponent("el-radio"),i=resolveComponent("el-radio-group"),u=resolveComponent("el-switch"),p=resolveComponent("el-form"),f=resolveComponent("el-collapse-item"),V=resolveComponent("codeEditor"),k=resolveComponent("el-collapse"),h=resolveComponent("el-tab-pane"),_=resolveComponent("el-tabs"),C=resolveComponent("el-button");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_,{modelValue:e.activeName,"onUpdate:modelValue":t[20]||(t[20]=t=>e.activeName=t),onTabClick:e.handleClick},{"default":withCtx((()=>[createVNode(h,{label:"新建服务器",name:"first"},{"default":withCtx((()=>[createVNode(k,{modelValue:e.activeViewName,"onUpdate:modelValue":t[19]||(t[19]=t=>e.activeViewName=t)},{"default":withCtx((()=>[createVNode(f,{title:"基本信息",name:"1"},{"default":withCtx((()=>[createBaseVNode("div",_hoisted_2,[createVNode(p,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"98px"},{"default":withCtx((()=>[createVNode(d,{label:"名称"},{"default":withCtx((()=>[createVNode(c,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.name=t),"show-word-limit":"",maxlength:"20",placeholder:"请填写名称"},null,8,["modelValue"])])),_:1}),createVNode(d,{label:"类型"},{"default":withCtx((()=>[createVNode(s,{onChange:e.handleChangeType,modelValue:e.form.types,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.types=t),placeholder:"请选择类型"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.network_server_type,(e=>(openBlock(),createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"])])),_:1}),"tcp"==e.form.types?(openBlock(),createBlock(d,{key:0,label:"粘拆包规则"},{"default":withCtx((()=>[createVNode(s,{onChange:e.initData,modelValue:e.stickValue,"onUpdate:modelValue":t[2]||(t[2]=t=>e.stickValue=t),placeholder:"请选择类型"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.stick_type,(e=>(openBlock(),createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"])])),_:1})):createCommentVNode("",!0),"tcp"==e.form.types&&e.stickValue?(openBlock(),createBlock(d,{key:1},{"default":withCtx((()=>["分隔符"==e.stickValue?(openBlock(),createBlock(d,{key:0,"class":"flex-column",label:"分隔符"},{"default":withCtx((()=>[createVNode(c,{modelValue:e.stick["delimit,omitempty"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.stick["delimit,omitempty"]=t),placeholder:"请填写分隔符"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"自定义脚本"==e.stickValue?(openBlock(),createBlock(d,{key:1,"class":"flex-column",label:"自定义脚本"},{"default":withCtx((()=>[createVNode(c,{modelValue:e.stick["custom,omitempty"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.stick["custom,omitempty"]=t),placeholder:"请填写自定义脚本"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"固定长度"==e.stickValue?(openBlock(),createBlock(d,{key:2,"class":"flex-column",label:"固定长度"},{"default":withCtx((()=>[createVNode(c,{type:"number",modelValue:e.stick["fixedLen,omitempty"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.stick["fixedLen,omitempty"]=t),placeholder:"请填写固定长度"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"长度字段"==e.stickValue?(openBlock(),createBlock(d,{key:3,"class":"flex-column",label:"长度"},{"default":withCtx((()=>[createVNode(c,{type:"number",modelValue:e.stick["len,omitempty"].len,"onUpdate:modelValue":t[6]||(t[6]=t=>e.stick["len,omitempty"].len=t),placeholder:"请填写长度"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"长度字段"==e.stickValue?(openBlock(),createBlock(d,{key:4,"class":"flex-column",label:"偏移量"},{"default":withCtx((()=>[createVNode(c,{type:"number",modelValue:e.stick["len,omitempty"].offset,"onUpdate:modelValue":t[7]||(t[7]=t=>e.stick["len,omitempty"].offset=t),placeholder:"请填写偏移量"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"长度字段"==e.stickValue?(openBlock(),createBlock(d,{key:5,"class":"flex-column",label:"大小端"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.stick["len,omitempty"].endian,"onUpdate:modelValue":t[8]||(t[8]=t=>e.stick["len,omitempty"].endian=t),placeholder:"请选择大小端"},{"default":withCtx((()=>[createVNode(m,{label:"大端",value:"大端"}),createVNode(m,{label:"小端",value:"小端"})])),_:1},8,["modelValue"])])),_:1})):createCommentVNode("",!0)])),_:1})):createCommentVNode("",!0),createVNode(d,{label:"地址"},{"default":withCtx((()=>[createVNode(c,{modelValue:e.form.addr,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.addr=t),placeholder:"端口号"},null,8,["modelValue"])])),_:1}),createVNode(d,{label:"开启TLS"},{"default":withCtx((()=>[createVNode(i,{modelValue:e.form.isTls,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.isTls=t),"class":"ml-4"},{"default":withCtx((()=>[createVNode(n,{label:1},{"default":withCtx((()=>[createTextVNode("是")])),_:1}),createVNode(n,{label:0},{"default":withCtx((()=>[createTextVNode("否")])),_:1})])),_:1},8,["modelValue"])])),_:1}),1==e.form.isTls&&"mqtt_server"!=e.form.types?(openBlock(),createBlock(d,{key:2,label:"选择证书"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.certificateId,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.certificateId=t),placeholder:"请选择证书"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.certificateList,(e=>(openBlock(),createBlock(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):createCommentVNode("",!0),1==e.form.isTls&&"mqtt_server"==e.form.types?(openBlock(),createBlock(d,{key:3,label:"接入方式"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.authType,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.authType=t),placeholder:"选择接入方式"},{"default":withCtx((()=>[createVNode(m,{label:"Basic",value:1}),createVNode(m,{label:"AccessToken",value:2})])),_:1},8,["modelValue"]),1==e.form.authType?(openBlock(),createBlock(d,{key:0,"class":"flex-column",label:"用户名"},{"default":withCtx((()=>[createVNode(c,{modelValue:e.form.authUser,"onUpdate:modelValue":t[13]||(t[13]=t=>e.form.authUser=t),placeholder:"请填写用户名"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),1==e.form.authType?(openBlock(),createBlock(d,{key:1,"class":"flex-column",label:"密码"},{"default":withCtx((()=>[createVNode(c,{modelValue:e.form.authPasswd,"onUpdate:modelValue":t[14]||(t[14]=t=>e.form.authPasswd=t),placeholder:"请填写密码"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),2==e.form.authType?(openBlock(),createBlock(d,{key:2,"class":"flex-column",label:"Aceess Token"},{"default":withCtx((()=>[createVNode(c,{modelValue:e.form.accessToken,"onUpdate:modelValue":t[15]||(t[15]=t=>e.form.accessToken=t),placeholder:"请填写Aceess Token"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0)])),_:1})):createCommentVNode("",!0),createVNode(d,{label:"启用"},{"default":withCtx((()=>[createVNode(u,{"active-value":1,"inactive-value":0,modelValue:e.form.status,"onUpdate:modelValue":t[16]||(t[16]=t=>e.form.status=t)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1}),createVNode(f,{title:"注册包",name:"2"},{"default":withCtx((()=>[createVNode(p,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"98px"},{"default":withCtx((()=>[createVNode(d,{label:"正则表达式"},{"default":withCtx((()=>[createVNode(c,{modelValue:e.form.register.regex,"onUpdate:modelValue":t[17]||(t[17]=t=>e.form.register.regex=t),placeholder:"请填写名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1}),createVNode(f,{title:"协议适配",name:"3"},{"default":withCtx((()=>[createVNode(p,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"98px"},{"default":withCtx((()=>[createVNode(d,{label:"协议"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.protocol.name,"onUpdate:modelValue":t[18]||(t[18]=t=>e.form.protocol.name=t),placeholder:"请选择协议适配"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.messageData,(e=>(openBlock(),createBlock(m,{key:e.types,label:e.title,value:e.name},null,8,["label","value"])))),128)),createVNode(m,{label:"Sagoo Mqtt",value:"SagooMqtt"})])),_:1},8,["modelValue"])])),_:1}),createVNode(d,{label:"协议参数"},{"default":withCtx((()=>[createVNode(V,{"class":"params",ref:"mirrorRef",mode:e.resourceModalPro.mode,content:e.resourceModalPro.content},null,8,["mode","content"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue","onTabClick"]),createBaseVNode("div",_hoisted_3,[createVNode(C,{size:"small",onClick:t[21]||(t[21]=t=>e.$router.replace("/iotmanager/network/server"))},{"default":withCtx((()=>[createTextVNode("取消")])),_:1}),createVNode(C,{onClick:e.submit,size:"small",type:"primary"},{"default":withCtx((()=>[createTextVNode("提交")])),_:1},8,["onClick"])])])}var create=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-f7d8729e"]]);export{create as default};